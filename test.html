  <body class="skin-simplememory has-navbar mathjax2">
    <a name="top"></a>
    <div id="top_nav" class="navbar forpc">
      <nav id="nav_main" class="navbar-main">
        <ul id="nav_left" class="navbar-list navbar-left">
          <li class="navbar-branding">
            <a
              href="https://www.cnblogs.com/"
              title="开发者的网上家园"
              role="banner"
            >
              <img src="//common.cnblogs.com/logo.svg" alt="博客园Logo" />
            </a>
          </li>
          <li>
            <a href="/" onclick="countClicks('skin-navbar-sitehome')">首页</a>
          </li>
          <li>
            <a
              href="https://news.cnblogs.com/"
              onclick="countClicks('nav', 'skin-navbar-news')"
              >新闻</a
            >
          </li>
          <li>
            <a
              href="https://q.cnblogs.com/"
              onclick="countClicks('nav', 'skin-navbar-q')"
              >博问</a
            >
          </li>
          <li>
            <a
              id="nav_brandzone"
              href="https://brands.cnblogs.com/"
              onclick="countClicks('nav', 'skin-navbar-brands')"
              >专区</a
            >
          </li>
          <li>
            <a
              href="https://ing.cnblogs.com/"
              onclick="countClicks('nav', 'skin-navbar-ing')"
              >闪存</a
            >
          </li>
          <li>
            <a
              href="https://edu.cnblogs.com/"
              onclick="countClicks('nav', 'skin-navbar-edu')"
              >班级</a
            >
          </li>
        </ul>
        <ul id="nav_right" class="navbar-list navbar-right">
          <li>
            <form
              id="zzk_search"
              class="navbar-search dropdown"
              action="https://zzk.cnblogs.com/s"
              method="get"
              role="search"
            >
              <input
                name="w"
                id="zzk_search_input"
                placeholder="代码改变世界"
                type="search"
                tabindex="3"
                autocomplete="off"
              />
              <button
                id="zzk_search_button"
                onclick="window.navbarSearchManager.triggerActiveOption()"
              >
                <img
                  id="search_icon"
                  class="focus-hidden"
                  src="//common.cnblogs.com/images/blog/search.svg"
                  alt="搜索"
                />
                <img
                  class="hidden focus-visible"
                  src="/images/enter.svg"
                  alt="搜索"
                />
              </button>
              <ul
                id="navbar_search_options"
                class="dropdown-menu quick-search-menu"
              >
                <li
                  tabindex="0"
                  class="active"
                  onclick="zzkSearch(event, document.getElementById('zzk_search_input').value)"
                >
                  <div class="keyword-wrapper">
                    <img
                      src="//common.cnblogs.com/images/blog/search.svg"
                      alt="搜索"
                    />
                    <div class="keyword"></div>
                  </div>
                  <span class="search-area">所有博客</span>
                </li>
                <li
                  tabindex="1"
                  onclick="zzkBlogSearch(event, 'Mr-Spade', document.getElementById('zzk_search_input').value)"
                >
                  <div class="keyword-wrapper">
                    <img
                      src="//common.cnblogs.com/images/blog/search.svg"
                      alt="搜索"
                    />
                    <div class="keyword"></div>
                  </div>
                  <span class="search-area">当前博客</span>
                </li>
              </ul>
            </form>
          </li>
          <li id="navbar_login_status" class="navbar-list">
            <a
              class="navbar-user-info navbar-blog"
              href="https://i.cnblogs.com/EditPosts.aspx?opt=1"
              alt="写随笔"
              title="写随笔"
            >
              <img
                id="new_post_icon"
                class="navbar-icon"
                src="//common.cnblogs.com/images/blog/newpost.svg"
                alt="写随笔"
              />
            </a>
            <a
              id="navblog-myblog-icon"
              class="navbar-user-info navbar-blog"
              href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx"
              alt="我的博客"
              title="我的博客"
            >
              <img
                id="myblog_icon"
                class="navbar-icon"
                src="//common.cnblogs.com/images/blog/myblog.svg"
                alt="我的博客"
              />
            </a>
            <a
              class="navbar-user-info navbar-message navbar-icon-wrapper"
              href="https://msg.cnblogs.com/"
              alt="短消息"
              title="短消息"
            >
              <img
                id="msg_icon"
                class="navbar-icon"
                src="//common.cnblogs.com/images/blog/message.svg"
                alt="短消息"
              />
              <span id="msg_count" style="display: none"></span>
            </a>
            <a
              id="navbar_lite_mode_indicator"
              data-current-page="blog"
              style="display: none"
              href="javascript:void(0)"
              alt="简洁模式"
              title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示"
            >
              <img
                class="navbar-icon"
                src="//common.cnblogs.com/images/blog/lite-mode-on.svg"
                alt="简洁模式"
              />
            </a>
            <div id="user_info" class="navbar-user-info dropdown">
              <a class="dropdown-button" href="https://home.cnblogs.com/">
                <img
                  id="user_icon"
                  class="navbar-avatar"
                  src="//common.cnblogs.com/images/blog/avatar-default.svg"
                  alt="用户头像"
                />
              </a>
              <div class="dropdown-menu">
                <a
                  id="navblog-myblog-text"
                  href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx"
                  >我的博客</a
                >
                <a href="https://home.cnblogs.com/">我的园子</a>
                <a href="https://account.cnblogs.com/settings/account"
                  >账号设置</a
                >
                <a
                  href="javascript:void(0)"
                  id="navbar_lite_mode_toggle"
                  title="简洁模式会使用简洁款皮肤显示所有博客"
                >
                  简洁模式
                  <img
                    id="navbar_lite_mode_on"
                    src="/images/lite-mode-check.svg"
                    class="hide"
                  /><span id="navbar_lite_mode_spinner" class="hide">...</span>
                </a>
                <a href="javascript:void(0)" onclick="account.logout();"
                  >退出登录</a
                >
              </div>
            </div>
            <a
              class="navbar-anonymous"
              href="https://account.cnblogs.com/signup"
              >注册</a
            >
            <a
              class="navbar-anonymous"
              href="javascript:void(0);"
              onclick="account.login()"
              >登录</a
            >
          </li>
        </ul>
      </nav>
    </div>

    <!--done-->
    <div id="home">
      <div id="header">
        <div id="blogTitle">
          <a id="lnkBlogLogo" href="https://www.cnblogs.com/Mr-Spade/"
            ><img
              id="blogLogo"
              src="/skins/custom/images/logo.gif"
              alt="返回主页"
          /></a>

          <!--done-->
          <h1>
            <a
              id="Header1_HeaderTitle"
              class="headermaintitle HeaderMainTitle"
              href="https://www.cnblogs.com/Mr-Spade/"
              >Mr_Spade</a
            >
          </h1>
          <h2>从一缕微光开始。</h2>
        </div>
        <!--end: blogTitle 博客的标题和副标题 -->
        <div id="navigator">
          <ul id="navList">
            <li>
              <a
                id="blog_nav_sitehome"
                class="menu"
                href="https://www.cnblogs.com/"
              >
                博客园</a
              >
            </li>
            <li>
              <a
                id="blog_nav_myhome"
                class="menu"
                href="https://www.cnblogs.com/Mr-Spade/"
              >
                首页</a
              >
            </li>
            <li>
              <a
                id="blog_nav_newpost"
                class="menu"
                href="https://i.cnblogs.com/EditPosts.aspx?opt=1"
              >
                新随笔</a
              >
            </li>
            <li>
              <a
                id="blog_nav_contact"
                class="menu"
                href="https://msg.cnblogs.com/send/Mr_Spade"
              >
                联系</a
              >
            </li>
            <li>
              <a
                id="blog_nav_rss"
                class="menu"
                href="javascript:void(0)"
                data-rss="https://www.cnblogs.com/Mr-Spade/rss/"
              >
                订阅</a
              >
              <!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>-->
            </li>
            <li>
              <a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
                管理</a
              >
            </li>
          </ul>

          <div class="blogStats">
            <div id="blog_stats_place_holder">
              <script>
                loadBlogStats();
              </script>
            </div>
          </div>
          <!--end: blogStats -->
        </div>
        <!--end: navigator 博客导航栏 -->
      </div>
      <!--end: header 头部 -->
      <div id="main">
        <div id="mainContent">
          <div class="forFlow">
            <div id="post_detail">
              <!--done-->
              <div id="topics">
                <div class="post">
                  <h1 class="postTitle">
                    <a
                      id="cb_post_title_url"
                      class="postTitle2 vertical-middle"
                      href="https://www.cnblogs.com/Mr-Spade/p/9636935.html"
                    >
                      <span role="heading" aria-level="2"
                        >网络最大流——最高标号预流推进</span
                      >
                    </a>
                  </h1>
                  <div class="clear"></div>
                  <div class="postBody">
                    <div
                      id="cnblogs_post_body"
                      class="blogpost-body cnblogs-markdown"
                    >
                      <h2 id="0写在前面">0、写在前面</h2>
                      <p>
                        解决最大流问题，最常用的算法是<span class="math inline"
                          >\(Dinic\)</span
                        >和<span class="math inline">\(ISAP\)</span
                        >，两种算法在实际应用中都相当快速。但是就理论而言，两种算法都属于增广路算法，复杂度上界都达到了<span
                          class="math inline"
                          >\(O(n^2 m)\)</span
                        >，因此在某些题目中或许存在<s>毒瘤</s>出题人构造数据卡这两种算法的情况。因此本文讲解一种复杂度上界在常用最大流算法中最优的最高标号预留推进算法（又叫<span
                          class="math inline"
                          >\(HLPP\)</span
                        >），其上界为<span class="math inline"
                          >\(O(n^2 \sqrt m)\)</span
                        >，<strong>并且在经过优化后这种算法在数据随机的情况下速度也不亚于上述两种增广路算法</strong>。
                      </p>
                      <p>
                        <mark
                          ><mark
                            ><mark
                              ><mark
                                ><mark
                                  ><mark
                                    ><mark
                                      ><mark
                                        >抱歉...我已经
                                        绝对不可能再获得幸福了</mark
                                      ></mark
                                    ></mark
                                  ></mark
                                ></mark
                              ></mark
                            ></mark
                          ></mark
                        >
                      </p>
                      <h2 id="1预流推进的思想">1、预流推进的思想</h2>
                      <p>
                        <span class="math inline">\(HLPP\)</span
                        >是预流推进算法中的一种，介绍一下预留推进算法的思想：
                      </p>
                      <p>
                        我们还是以水流来类比网络流。我们将每个点看作一个水库，每条边看作单向的管道。预流推进算法的思想就是，允许水在非源汇点的节点中暂时存储（我们将存储在非源汇点中的流称作这个点的<strong>超额流</strong>），同时伺机将自身的超额流通过管道<strong>推送</strong>出去。只要保证在算法结束后所有非源汇点的超额流都为<span
                          class="math inline"
                          >\(0\)</span
                        >，那么这种方案就是合法的。
                      </p>
                      <p>
                        同时为了避免反复推送而出现死循环的问题，我们再给每个节点引入<strong>高度</strong>的概念。同实际中一样，我们只允许高度较高的节点向高度较低的节点进行推送（不过还是略有不同，具体请见下文）。如果一个节点因为受到高度的限制而不能推送自身的超额流，那么我们就抬高这个节点的高度，我们把这个操作叫做<strong>重贴标签</strong>。
                      </p>
                      <p>
                        <mark
                          ><mark
                            ><mark
                              ><mark
                                ><mark
                                  ><mark
                                    ><mark
                                      ><mark>因为...我发现...</mark></mark
                                    ></mark
                                  ></mark
                                ></mark
                              ></mark
                            ></mark
                          ></mark
                        >
                      </p>
                      <h2 id="2最高标号预流推进的过程">
                        2、最高标号预流推进的过程
                      </h2>
                      <p>
                        下面介绍<span class="math inline">\(HLPP\)</span
                        >的具体流程，在下文中，我们用<span class="math inline"
                          >\(e_v\)</span
                        >表示节点<span class="math inline">\(v\)</span
                        >的超额流，用<span class="math inline">\(h_v\)</span
                        >表示节点<span class="math inline">\(v\)</span>的高度。
                      </p>
                      <p>
                        首先，我们将除了源点以外的节点的高度都置为<span
                          class="math inline"
                          >\(0\)</span
                        >。特别地，我们将源点<span class="math inline"
                          >\(s\)</span
                        >的高度置为<span class="math inline">\(n\)</span
                        >，并且将<span class="math inline">\(s\)</span
                        >的所有边都充满流量推送出去。我们不必担心这种操作会让流变得太多，因为多余的流量会在别的节点高度抬高到超过<span
                          class="math inline"
                          >\(s\)</span
                        >以后推送回去。我们还应该将推送过后超额流不为<span
                          class="math inline"
                          >\(0\)</span
                        >的节点加入队列中等待推送，同时，因为<span
                          class="math inline"
                          >\(HLPP\)</span
                        >会要求我们每次都推送高度最高的节点（注意是对于超额流不为<span
                          class="math inline"
                          >\(0\)</span
                        >的节点而言的），因此这应当是一个以高度为键值的优先队列。
                      </p>
                      <p>
                        在进行完上述操作以后，我们开始处理优先队列。我们每次都取出队首<span
                          class="math inline"
                          >\(v\)</span
                        >并尝试推送，推送过程如下：
                      </p>
                      <p>
                        逐一检查<span class="math inline">\(v\)</span
                        >的出边，如果发现某条边还有流量并且边的另一端<span
                          class="math inline"
                          >\(u\)</span
                        >满足<span class="math inline">\(h_u+1=h_v\)</span
                        >，即<span class="math inline">\(v\)</span>正好比<span
                          class="math inline"
                          >\(u\)</span
                        >的高度高<span class="math inline">\(1\)</span
                        >（注意在初始操作中对<span class="math inline"
                          >\(s\)</span
                        >的推送并没有这个要求），那么这条边就是可以推送的。我们推送的流量应当既不可以超过这条边的流量，也不可以超过<span
                          class="math inline"
                          >\(e_v\)</span
                        >。在推送完成后记得修改<span class="math inline"
                          >\(u\)</span
                        >和<span class="math inline">\(v\)</span
                        >的超额流，并且如果<span class="math inline">\(u\)</span
                        >还不在优先队列中，那么应当将<span class="math inline"
                          >\(u\)</span
                        >加入优先队列。
                      </p>
                      <p>
                        推送过程执行完毕后，如果我们发现<span
                          class="math inline"
                          >\(e_v\)</span
                        >仍然不等于<span class="math inline">\(0\)</span
                        >，说明当前的高度<span class="math inline">\(h_v\)</span
                        >并不够，因此我们对<span class="math inline">\(v\)</span
                        >重贴标签。我们找到有流量而且边的另一端<span
                          class="math inline"
                          >\(u\)</span
                        >高度最小的边，将<span class="math inline">\(h_v\)</span
                        >设置为<span class="math inline">\(h_u+1\)</span
                        >，这样就保证了下次一定可以推送。于是我们再将重贴标签后的<span
                          class="math inline"
                          >\(v\)</span
                        >加入优先队列中。
                      </p>
                      <p>
                        如果优先队列为空，那么除了源汇点以外的所有节点超额流都为<span
                          class="math inline"
                          >\(0\)</span
                        >，这是一个合法的流，并且也是最大流。
                      </p>
                      <p>
                        <mark
                          ><mark
                            ><mark
                              ><mark
                                ><mark
                                  ><mark
                                    ><mark
                                      ><mark
                                        >其实我...早就已经被幸福包围了</mark
                                      ></mark
                                    ></mark
                                  ></mark
                                ></mark
                              ></mark
                            ></mark
                          ></mark
                        >
                      </p>
                      <h2 id="3一点优化">3、一点优化</h2>
                      <p>
                        虽然上述的算法是正确的，并且复杂度是<span
                          class="math inline"
                          >\(O(n^2 \sqrt m)\)</span
                        >的，但是因为缺少一些优化，使得其上界比较紧，因此在随机数据下可能不如增广路算法。下面介绍对<span
                          class="math inline"
                          >\(HLPP\)</span
                        >的优化，使得其在随机数据下的速度可以与增广路算法媲美。
                      </p>
                      <p>
                        首先，我们可以发现将所有非源点的高度设置为<span
                          class="math inline"
                          >\(0\)</span
                        >是有些浪费的。我们不妨通过一遍<span class="math inline"
                          >\(bfs\)</span
                        >将每个点的初始高度设置为它到汇点<span
                          class="math inline"
                          >\(t\)</span
                        >的最短距离，这样就节省了大量重贴标签操作。当然，源点<span
                          class="math inline"
                          >\(s\)</span
                        >的高度还是应该设置为<span class="math inline"
                          >\(n\)</span
                        >。
                      </p>
                      <p>
                        然后，我们还可以发现如果一个点<span class="math inline"
                          >\(v\)</span
                        >再被重贴标签以后，如果它原来的高度已经没有其它点，那么高于它的点一定不能将流量推送到<span
                          class="math inline"
                          >\(t\)</span
                        >了。所以我们可以将高度大于<span class="math inline"
                          >\(h_v\)</span
                        >且小于<span class="math inline">\(n+1\)</span
                        >的点高度设置为<span class="math inline">\(n+1\)</span
                        >，以便尽快将流量推送给<span class="math inline"
                          >\(s\)</span
                        >。对于如何判断这个高度已经没有其它节点，可以和<span
                          class="math inline"
                          >\(ISAP\)</span
                        >一样用一个<span class="math inline">\(gap\)</span
                        >数组来计数，这就是<span class="math inline"
                          >\(HLPP\)</span
                        >的<span class="math inline">\(gap\)</span>优化。
                      </p>
                      <p>
                        <mark
                          ><mark
                            ><mark
                              ><mark
                                ><mark
                                  ><mark
                                    ><mark
                                      ><mark
                                        >——珂朵莉·诺塔·瑟尼欧里斯</mark
                                      ></mark
                                    ></mark
                                  ></mark
                                ></mark
                              ></mark
                            ></mark
                          ></mark
                        >
                      </p>
                      <h2 id="4c实现">4、C++实现</h2>
                      <p>
                        因为<span class="math inline">\(HLPP\)</span
                        >的细节还是挺多的，这里就放一下我的代码吧。<span
                          class="math inline"
                          >\(HLPP\)</span
                        >的码量其实不多，我这样的写法也只是<span
                          class="math inline"
                          >\(100\)</span
                        >行出头而已。所以在网络流问题中使用<span
                          class="math inline"
                          >\(HLPP\)</span
                        >也是一个不错的选择。
                      </p>
                      <pre><code class="language-cpp">#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;algorithm&gt;
#include&lt;queue&gt;
using std::min;
using std::vector;
using std::queue;
using std::priority_queue;
const int N=2e4+5,M=2e5+5,inf=0x3f3f3f3f;
int n,s,t,tot;
int v[M&lt;&lt;1],w[M&lt;&lt;1],first[N],next[M&lt;&lt;1];
int h[N],e[N],gap[N&lt;&lt;1],inq[N];//节点高度是可以到达2n-1的
struct cmp
{
	inline bool operator()(int a,int b) const
	{
		return h[a]&lt;h[b];//因为在优先队列中的节点高度不会改变，所以可以直接比较
	}
};
queue&lt;int&gt; Q;
priority_queue&lt;int,vector&lt;int&gt;,cmp&gt; pQ;
inline void add_edge(int from,int to,int flow)
{
	tot+=2;
	v[tot+1]=from;v[tot]=to;w[tot]=flow;w[tot+1]=0;
	next[tot]=first[from];first[from]=tot;
	next[tot+1]=first[to];first[to]=tot+1;
	return;
}
inline bool bfs()
{
	int now;
	register int go;
	memset(h+1,0x3f,sizeof(int)*n);
	h[t]=0;Q.push(t);
	while(!Q.empty())
	{
		now=Q.front();Q.pop();
		for(go=first[now];go;go=next[go])
			if(w[go^1]&amp;&amp;h[v[go]]&gt;h[now]+1)
				h[v[go]]=h[now]+1,Q.push(v[go]);
	}
	return h[s]!=inf;
}
inline void push(int now)//推送
{
	int d;
	register int go;
	for(go=first[now];go;go=next[go])
		if(w[go]&amp;&amp;h[v[go]]+1==h[now])
		{
			d=min(e[now],w[go]);
			w[go]-=d;w[go^1]+=d;e[now]-=d;e[v[go]]+=d;
			if(v[go]!=s&amp;&amp;v[go]!=t&amp;&amp;!inq[v[go]])
				pQ.push(v[go]),inq[v[go]]=1;
			if(!e[now])//已经推送完毕可以直接退出
				break;
		}
	return;
}
inline void relabel(int now)//重贴标签
{
	register int go;
	h[now]=inf;
	for(go=first[now];go;go=next[go])
		if(w[go]&amp;&amp;h[v[go]]+1&lt;h[now])
			h[now]=h[v[go]]+1;
	return;
}
inline int hlpp()
{
	int now,d;
	register int i,go;
	if(!bfs())//s和t不连通
		return 0;
	h[s]=n;
	memset(gap,0,sizeof(int)*(n&lt;&lt;1));
	for(i=1;i&lt;=n;i++)
		if(h[i]&lt;inf)
			++gap[h[i]];
	for(go=first[s];go;go=next[go])
		if(d=w[go])
		{
			w[go]-=d;w[go^1]+=d;e[s]-=d;e[v[go]]+=d;
			if(v[go]!=s&amp;&amp;v[go]!=t&amp;&amp;!inq[v[go]])
				pQ.push(v[go]),inq[v[go]]=1;
		}
	while(!pQ.empty())
	{
		inq[now=pQ.top()]=0;pQ.pop();push(now);
		if(e[now])
		{
			if(!--gap[h[now]])//gap优化，因为当前节点是最高的所以修改的节点一定不在优先队列中，不必担心修改对优先队列会造成影响
				for(i=1;i&lt;=n;i++)
					if(i!=s&amp;&amp;i!=t&amp;&amp;h[i]&gt;h[now]&amp;&amp;h[i]&lt;n+1)
						h[i]=n+1;
			relabel(now);++gap[h[now]];
			pQ.push(now);inq[now]=1;
		}
	}
	return e[t];
}
int m;
signed main()
{
	int u,v,w;
	scanf("%d%d%d%d",&amp;n,&amp;m,&amp;s,&amp;t);
	while(m--)
	{
		scanf("%d%d%d",&amp;u,&amp;v,&amp;w);
		add_edge(u,v,w);
	}
	printf("%d\n",hlpp());
	return 0;
}
</code></pre>
                    </div>
                    <div class="clear"></div>
                    <div id="blog_post_info_block" role="contentinfo">
                      <div id="blog_post_info"></div>
                      <div class="clear"></div>
                      <div id="post_next_prev"></div>
                    </div>
                  </div>
                  <div class="postDesc">
                    posted @
                    <span
                      id="post-date"
                      data-last-update-days="1533.281789138302"
                      data-date-created="BlogServer.Application.Dto.BlogPost.BlogPostDto"
                      data-date-updated="2019-01-04 15:16"
                      >2018-09-12 19:55</span
                    >&nbsp;
                    <a href="https://www.cnblogs.com/Mr-Spade/">Mr_Spade</a
                    >&nbsp; 阅读(<span id="post_view_count">2237</span>)&nbsp;
                    评论(<span id="post_comment_count">2</span>)&nbsp;
                    <a
                      href="https://i.cnblogs.com/EditPosts.aspx?postid=9636935"
                      rel="nofollow"
                      >编辑</a
                    >&nbsp;
                    <a
                      href="javascript:void(0)"
                      onclick="AddToWz(9636935);return false;"
                      >收藏</a
                    >&nbsp;
                    <a
                      href="javascript:void(0)"
                      onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '9636935', targetLink: 'https://www.cnblogs.com/Mr-Spade/p/9636935.html', title: '网络最大流——最高标号预流推进' })"
                      >举报</a
                    >
                  </div>
                </div>
              </div>
              <!--end: topics 文章、评论容器-->
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
